---
version: '3'

services:

  solr-sdr-catalog:
    image: ghcr.io/hathitrust/catalog-solr
    ports:
      - "9033:9033"

  nginx:
    image: nginx
    ports:
      - "8080:8080"
    volumes:
      - ./docker/nginx-default.conf:/etc/nginx/conf.d/default.conf
      - .:/app
    depends_on:
      - vufind

  # Uncomment the networks block if you want to connect to solr running
  # elsewhere
  vufind:
    build: .
    hostname: 'catalog-dev'
    volumes:
      - .:/app
    depends_on:
      - mysql-sdr
#     networks:
#       - catalog_indexer
#       - default

  mysql-sdr:
    image: mariadb
    volumes:
      - ./docker/vufind.sql:/docker-entrypoint-initdb.d/vufind.sql
    environment:
      - MARIADB_RANDOM_ROOT_PASSWORD=1

# networks:
#   catalog_indexer:
#     external: true
#     # Adjust this if the running solr is in another docker network
#     name: hathitrust_catalog_indexer_default
#   default:
#     external: false
